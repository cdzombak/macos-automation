#!/bin/bash

# Log the date of the last backup on a SuperDuper clone
# WARNING: This script overwrites the file /___SuperDuper-Backup.txt on the destination volume.

# Inspired by https://oleb.net/blog/2018/01/superduper-last-backup-timestamp/

if [ ${#} -lt 5 ]; then
    echo "${0} error: expected at least 5 arguments, but there are only ${#} arguments."
    echo "Expected list of parameters:"
    echo "1. The name of the source volume (e.g. Macintosh HD)"
    echo "2. The mount path of the source volume (e.g. /)"
    echo "3. The name of the destination volume (e.g. Sandbox)"
    echo "4. The path of the destination (e.g. /Volumes/Sandbox)"
    echo "5. The name of the script the user selected (e.g. Copy â€“ all files)"
    echo "6. (optional) The name of the image file being processed, if any"
    exit 1
fi

SOURCE_VOLUME=${1}
SOURCE_PATH=${2}
DESTINATION_VOLUME=${3}
DESTINATION_PATH=${4}
BACKUP_SCRIPT=${5}
DISK_IMAGE_NAME_IF_ANY=${6}

LOGFILE_NAME="___SuperDuper-Backup.txt"
LOGFILE_PATH="${DESTINATION_PATH}/${LOGFILE_NAME}"

cat >"${LOGFILE_PATH}" <<EOF
SuperDuper Backup Log
---------------------

Autogenerated by script: ${0}

Backup finished at: $(date)

Source volume: ${SOURCE_VOLUME}
Source volume mount path: ${SOURCE_PATH}
Destination volume: ${DESTINATION_VOLUME}
Destination volume mount path: ${DESTINATION_PATH}
Backup script name: ${BACKUP_SCRIPT}
Disk image name (if any): ${DISK_IMAGE_NAME_IF_ANY}
EOF

terminal-notifier -message "Backup ${SOURCE_VOLUME} completed." -title "SuperDuper" -sender "com.blacey.SuperDuper\!" -sound "Purr"
