#!/usr/bin/env bash
set -eu

function usage_exit() {
	echo "usage: $(basename "$0") <n>|<descriptor>"
	echo ""
	echo "     - n may be an integer 0-9"
	echo "     - descriptor may be one of the following:"
	echo "         'home' for wired Perixx mouse (at home office desk) at 1600 DPI (its higher DPI setting)"
	echo ""
	exit 1
}

VALID_OPTS=(
	"home"
	"0"
	"1"
	"2"
	"3"
	"4"
	"5"
	"6"
	"7"
	"8"
	"9"
)
if [ "$#" -ne 1 ]; then
	usage_exit
fi
if [[ ! " ${VALID_OPTS[@]} " =~ " ${1} " ]]; then
	usage_exit
fi

SPD="$1"

if [ "$1" == "home" ]; then
	SPD="4"
fi

echo "Setting mouse tracking speed to $SPD..."

SCRIPTPATH="$( cd "$(dirname "$0")" ; pwd -P )"
timeout 15s osascript "$SCRIPTPATH/_mousetracking.scpt" "$SPD" || echo "If this automation failed, note that AEServer and the active terminal application must be granted Accessibility access in System Preferences / Security and Privacy."
